---
title: "02 Analysis"
date: "Last update: `r Sys.Date()`"
output:
  html_document:
    theme: paper
    highlight: kate
    code_folding: hide
    toc_depth: 3
    toc_float: true
---
<style>
.list-group-item.active, .list-group-item.active:hover, .list-group-item.active:focus {
  background-color: #00d188;
  border-color: #00d188;
}

body {
  font-family: montserrat;
  color: #444444;
  font-size: 14px;
}

h1 {
  font-weight: bold;
  font-size: 28px;
}

h1.title {
  font-size: 30px;
  color: #00d188;
}

h2 {
  font-size: 24px;
}

h3 {
  font-size: 18px;
}
</style>

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.showtext = TRUE)
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark = ",", small.mark = ",", scientific = F)
})
```


Google is said to have the most accurate search engine (X% market share). We wanted to test how accurate the other main search engines (Bing, DuckDuckGo, and Yahoo) are compared to Google.

We analysed 60k search results from each search engine and came up with some interesting insights.

# Summary of insights

1. DuckDuckGo is the most accurate search engine when compared to Google. 
Google's #1 search result was found in DuckDuckGo's top 10 67.3% of the time. 
Bing is close with 66.3% and Yahoo worse at 62.2%.

2. For all search engines, we see that accuracy slightly improves for high 
volume, with gains between 1.5% and 2% when comparing volume of more and less than 10k.

3. The accuracy of the search engines differs by category. Real Estate, Travel & Tourism, and Retailers & General Merchandise are more accurate across _all_ search engines. While Apparel, Beauty & Personal Care, and Home & Garden are less accurate.

4. The number of words in the search term is negatively correlated with accuracy. Search terms with _just_ one word are ~8% more accurate than those with multiple words

# Research questions (to do)

1. Bing and DuckDuck are more accurate (~75%) than Yahoo (66%) when compared to Google [DONE]
  - Top 10 is more frequently used to look at search results [TO-DO]

2. The higher the search volume the more accurate the search result [DONE]

3. The accuracy of the search engines differs by category. Real Estate, Travel & Tourism, and Retailers & General Merchandise are more accurate across all search engines. While Apparel, Beauty & Personal Care, and Home & Garden are less accurate. These trends are similar across all search engines but there are specific categories like Health where Yahoo is particularly less accurate. [DONE]
  - Split categories into further sub levels (if we have sufficient data) [To-DO]
  - Split categories by search volume) [To-DO]
  
4. The longer the keyword used in the search the more accurate the result. This could be because the longer the keyword, the more specific the search query. [DONE]
  - Look into # of words

5. How similar are the rankings between search engines? E.g. is Google’s top 10 exactly the same as DuckDuck

6. For results that produce a lot of the same domain, what is their accuracy? e.g. results that return lots of amazon links. We could look at domain accuracy in general as well

7. What is the average distance to Google #1 search result?

8. What can we learn from the description or titles? To brainstorm

See here an example example articles we did in the past  to get an idea for the end result and the type of findings we´re looking for: https://backlinko.com/google-ctr-stats; https://backlinko.com/page-speed-stats



```{r load_and_setup, echo = T}
library(tidyverse) # package used for data wrangling
# options(dplyr.summarise.inform = F)
theme_set(theme_minimal() +
            theme(plot.title = element_text(size = 15)))
# "datasets_for_report.Rdata" is built by the following commented calls
# source(here::here("scripts/01_build_light_dataset.R"))
# source(here::here("scripts/02_build_datasets_for_report.R"))
load(here::here("proc_data/datasets_for_report.Rdata"))
```


## How accurate are the other search engines?

We developed an accuracy measure that counts how many times a search engines results contains Google's #1 result in their top 10. 

If the search engine contained Google's #1 result for all of their keywords their accuracy would be 100%. While if they did not, their accuracy would be 0%.

We show below the accuracy for each search engine using the top 10 (as we will
in the rest of the report) as well as the top 20 and top 30 results.

We see that Yahoo is fairly behind both competitors and DuckDuckGo has a slight edge over Bing.


```{r, echo = T}
accuracy_by_se
```

### Monthly search volume

The sample of 60k search keywords were chosen so we got a fairly even split across different search volumes. 

```{r, echo = T}
monthly_search_volume
```

This means we're able to determine how search volume may affect the accuracy of the search engines. 
The effect is mild but we see an improvement for volumes over 10K searches per month.

```{r, echo = T}
accuracy_by_se_and_vol %>% 
  ggplot(aes(monthly_search_volume_level, y = accuracy, colour = search_engine,
             group = search_engine)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword's Monthly Search Volume", 50),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Monthly Search Volume",
       y = "Search Engine Accuracy")
```



### Keyword categories

Each of the keywords comes with categories (or tags). It's possible for keywords to belong to more than one category. The sample of 60k keywords was drawn randomly so we don't expect to have an equal amount in each category. 

The most common categories are News, Media & Publications, Arts & Entertainment, Business & Industrial, and Hobbies & Leisure.

```{r, echo = T}
category1_counts %>% 
  ggplot(aes(x = keyword_category, y = n)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_comma()) +

  labs(title = "# of Keywords by Category",
       x = "Keyword Category",
       y = NULL)
```

Deeper levels of categories are available, nested into the main categories,
we show below the breakdown of the level 2 and 3 categories.

```{r, echo = T}
category2_counts %>% 
  ggplot(aes(x = keyword_category, y = n)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_comma()) +

  labs(title = "# of Keywords by Category (level 2)",
       x = "Keyword Category",
       y = NULL)

category3_counts %>% 
  ggplot(aes(x = keyword_category, y = n)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_comma()) +

  labs(title = "# of Keywords by Category (level 3)",
       x = "Keyword Category",
       y = NULL)
  
```

The following chart shows that there is significant variance in accuracy depending on what category the keyword belongs too. Real Estate, Travel & Tourism, Retailers & General Merchandise, and Dining & Nightlife are the four most accurate categories across all the search engines (between 67% and 75%). While Home & Garden, Apparel, and Beauty & Personal Care are least accurate (between 55% and 61%).

Yahoo is also particularly less accurate in a couple of categories. For example, in Health Yahoo is 60% accurate (vs ~67% for the other two search engines). Similarly for Food & Groceries, and Beauty & Personal Care.

```{r, echo = T}
accuracy_by_se_and_category %>%
  ggplot(aes(x = keyword_category, y = accuracy,
             group = search_engine, colour = search_engine)) +
  geom_point() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Category", 30),
       # subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Category",
       y = "Search Engine Accuracy")
```

We reproduce this chart for the 10 biggest subcategories of level 2 and 3.

```{r, echo = T}
accuracy_by_se_and_category_2 %>%
  ggplot(aes(x = keyword_category, y = accuracy,
             group = search_engine, colour = search_engine)) +
  geom_point() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Category (level 2)", 30),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Category",
       y = "Search Engine Accuracy")

accuracy_by_se_and_category_3 %>%
  ggplot(aes(x = keyword_category, y = accuracy,
             group = search_engine, colour = search_engine)) +
  geom_point() +
  coord_flip() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Category (level 3)", 30),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Category",
       y = "Search Engine Accuracy")
```

Finally we offer a breakdown of the accuracy by main category and volume category.

We see that volume can make a big difference in some cases, for instance for
Health related keywords Bing and DuckDuck become much more accurate as volume increases.

We see also that Real Estate related searches give the most accurate results accross categories at lower volume.

```{r, echo = T}
accuracy_by_se_category_and_vol %>%
  ggplot(aes(x = keyword_category, y = accuracy,
             group = search_engine, colour = search_engine)) +
  geom_point() +
  coord_flip() +
  facet_wrap(vars(monthly_search_volume_level)) +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Category", 30),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Category",
       y = "Search Engine Accuracy")
```

### Number of words

Most keywords (search terms) have between 2 and 4 words. 
There are also 29 search terms that have at least 10 words. 
For example `what are the first ten amendments to the constitution called` and 
`how long does it take to become a pediatric nurse`.

```{r, echo = T}
kw_length_counts %>% 
  ggplot(aes(x = keyword_length, y = n)) +
  geom_col() +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  labs(title = "Keywords by # of Words",
       y = "# of Keywords",
       x = "# of Words in Keyword") +
  scale_y_continuous(labels = scales::label_comma())
```

For all three search engines, the search terms with only one word are the most
accurate, but we observe a "U" shape curve as longer keywords show more accurate 
results than medium length ones. 

On average accuracy for length 1 keywords is about 5% higher than for length 2,
and this difference is bigger for high volumes.

There might be two forces at play here, on one hand single word searches are more straightforward,
so we can expect search engines to converge more on them, and on the other hand
long keywords are more precise, so the pool of potential targets decreases with
the length of the search and long searches tend to converge over search engines too.

Searching for a brand name for instance, we expect to find the official website 
on the first result on all search engines, and searching for a blog article by typing
its full title we expect all search engines to propose it first as well.


```{r, echo = T}
accuracy_by_se_and_kw_length %>%
  ggplot(aes(keyword_length, y = accuracy, colour = search_engine,
             group = search_engine)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Length", 50),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Length in Words",
       y = "Search Engine Accuracy")

accuracy_by_se_vol_and_kw_length %>%
  ggplot(aes(keyword_length, y = accuracy, colour = search_engine,
             group = search_engine)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Keyword Length", 50),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Keyword Length in Words",
       y = "Search Engine Accuracy") +
  facet_wrap(vars(monthly_search_volume_level), ncol=3)
```

### How similar are the rankings between search engines?

We define similarity as the fraction of the top 10 for a each search engine that
we find in another's top 10.

We see that Yahoo and Google seem to work the most differently while Yahoo and
Bing are the most similar.

```{r}
similarity
```

### Domain specificity

We define the domain specificity of a keyword as the number of top 10 Google results 
that feature the dominant domain of this top 10. For instance a research that returns
3 ebay results, 5 amazon results, and 2 other results will have a domain specificity of 5.

We observe a U shape curve here too, searches that are very domain specific, or not at all,
show the most accuracy. It might be that moderate domain specificity is a symptom
of an unclear search, while very high product specificity shows that the search
was more precise.

```{r}

domain_specificity_by_kw %>%
  count(domain_specificity_grouped) %>%
  ggplot(aes(domain_specificity_grouped, n)) +
  geom_col() +
  geom_text(aes(label = n), nudge_y = 700) +
  ggtitle("breakdown of domain specificity in our sample") 

accuracy_by_se_and_spec %>%
  ggplot(aes(domain_specificity_grouped, y = accuracy, colour = search_engine,
             group = search_engine)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = str_wrap("Search Engine Accuracy by Domain Specificity", 50),
       subtitle = "Top 10",
       colour = "Search Engine", 
       x = "Domain specificity",
       y = "Search Engine Accuracy")
```

### At what position is Google's first result ?

The most likely position of the first google result is 1st, fr every search engine,
a situation that we find for 35% of keywords. 
The second most likely position is that it's not found at all in the top 30.

The median position of the first google result is 3 for all 3 google competitors.

```{r}
google1_positions %>%
  ggplot(aes(factor(google1_position), pct, fill = search_engine )) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = scales::label_percent()) +
  labs(title = "position of first google result",
      x = "position",
      y = "amount (%)")
```

```{r}
# computing the mean position is not possible because a fair amount of google
# first urls are just not found, so the mean is undefined, we can compute the 
# median position however, by assuming unfound is Inf
median_google1_positions
```


